---
title: "R清理列名称学习笔记"
format: 
  html:
    theme: cosmo
    toc: true
    toc - depth: 3
    # code-fold: true
---

# 1.库

```{r}
#| label: setup

knitr::opts_chunk$set(message = FALSE, warning = FALSE)

suppressPackageStartupMessages({
  library(readxl)
  library(janitor)
  library(dplyr)
})
```
```{r}
#｜label: load-libraries
#| warning: false

library(here)
library(tibble)
```

# 2.读取数据并清理列名称
```{r}
roster_raw <- read_excel(here("clean_data", "dirty_data.xlsx")) 
glimpse(roster_raw)

roster_raw2 <- roster_raw |>
  row_to_names(row_number = 1) |>
  clean_names()
glimpse(roster_raw2)
```

# 3.对比前后列名称
```{r}
orig_names <- roster_raw |>
  slice_head(n = 1) |>
  unlist(use.names = FALSE) |>
  as.character()

# 清理后列名
clean_names_vec <- colnames(roster_raw2)

# 如果长度不匹配，先对齐或填 NA
n <- max(length(orig_names), length(clean_names_vec))
orig_names <- c(orig_names, rep(NA_character_, n - length(orig_names)))
clean_names_vec <- c(
  clean_names_vec,
  rep(NA_character_, n - length(clean_names_vec))
)

# 建表对比
compare_names <- tibble(
  position = seq_len(n),
  original = orig_names,
  cleaned = clean_names_vec,
  cleaned_by_make_clean_names = janitor::make_clean_names(original),
  changed = !is.na(original) & (janitor::make_clean_names(original) != cleaned)
)

# 显示差异行（changed == TRUE）
library(DT)
# compare_table <- compare_names |> filter(changed)
datatable(compare_names)
```

# 4.总结
通过使用 janitor 包的 clean_names() 函数，我们成功地将数据框的列名称进行了清理，使其符合 R 语言的命名规范。清理后的列名称更易读、更一致，有助于后续的数据操作和分析工作。通过对比清理前后的列名称，我们可以清晰地看到哪些列名称发生了变化，从而验证清理过程的有效性。

查看列名的函数：
- colnames(): 获取或设置数据框的列名称。
- names(): 获取或设置对象的名称属性，适用于多种对象类型，包括数据框。
- glimpse(): 来自 dplyr 包，提供数据框的结构概览，包括列名称和数据类型。
- str(): R 的基础函数，显示对象的结构信息，包括列名称和数据类型。

处理第一行数据作为列名的函数：
- row_to_names(): 来自 janitor 包，将指定行的数据提升为列名称，并删除该行。

```{r}
row_to_names_example <- tibble(
  X1 = c("Name", "Age", "City"),
  X2 = c("Alice", 25, "New York"),
  X3 = c("Bob", 30, "Los Angeles")
)
row_to_names_example_cleaned <- row_to_names_example |>
  row_to_names(row_number = 1) |>
  clean_names()
row_to_names_example_cleaned
```